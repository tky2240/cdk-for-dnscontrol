"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.DnscontrolDsRecord = exports.getDsDigestTypeStringFromValue = exports.getDsAlgorithmStringFromValue = void 0;
const dnscontrol_record_1 = require("./dnscontrol-record");
const DNS_CONTROL_DS_RECORD_SYMBOL = Symbol.for("DnscontrolDsRecord");
//ref: https://www.iana.org/assignments/dns-sec-alg-numbers/dns-sec-alg-numbers.xhtml#prime-lengths
const dsAlgorithm = {
    DELETE: 0,
    RSAMD5: 1,
    DH: 2,
    DSA: 3,
    RSASHA1: 5,
    "DSA-NSEC3-SHA1": 6,
    "RSASHA1-NSEC3-SHA1": 7,
    RSASHA256: 8,
    RSASHA512: 10,
    "ECC-GOST": 12,
    ECDSAP256SHA256: 13,
    ECDSAP384SHA384: 14,
    ED25519: 15,
    ED448: 16,
    SM2SM3: 17,
    "ECC-GOST12": 23,
    INDIRECT: 252,
    PRIVATEDNS: 253,
    PRIVATEOID: 254,
};
function isDsAlgorithm(x) {
    return typeof x === "string" && Object.keys(dsAlgorithm).includes(x);
}
const getDsAlgorithmStringFromValue = (value) => {
    const algorithm = Object.entries(dsAlgorithm).find((dsAlgorithm) => {
        return dsAlgorithm[1] === value;
    });
    const dsAlgorithmString = algorithm?.[0];
    if (isDsAlgorithm(dsAlgorithmString)) {
        return dsAlgorithmString;
    }
    throw new Error(`Invalid DS algorithm value: ${value}`);
};
exports.getDsAlgorithmStringFromValue = getDsAlgorithmStringFromValue;
//ref: https://www.iana.org/assignments/ds-rr-types/ds-rr-types.xhtml
const dsDigestType = {
    SHA1: 1,
    SHA256: 2,
    GOST_R_34_11_94: 3,
    SHA384: 4,
    GOST_R_34_11_2012: 5,
    SM3: 6,
};
function isDsDigestType(x) {
    return typeof x === "string" && Object.keys(dsDigestType).includes(x);
}
const getDsDigestTypeStringFromValue = (value) => {
    const digestType = Object.entries(dsDigestType).find((dsDigestType) => {
        return dsDigestType[1] === value;
    });
    const dsDigestTypeString = digestType?.[0];
    if (isDsDigestType(dsDigestTypeString)) {
        return dsDigestTypeString;
    }
    throw new Error(`Invalid DS digest type value: ${value}`);
};
exports.getDsDigestTypeStringFromValue = getDsDigestTypeStringFromValue;
class DnscontrolDsRecord extends dnscontrol_record_1.DnscontrolRecord {
    keytag;
    algorithm;
    digestType;
    digest;
    constructor(scope, id, props) {
        super(scope, id, {
            recordType: "DS",
            label: props.label,
            target: "",
            ttl: props.ttl,
            isEnsuredAbsent: props.isEnsuredAbsent,
            meta: props.meta,
        });
        this.keytag = props.keytag;
        this.algorithm = props.algorithm;
        this.digestType = props.digestType;
        this.digest = props.digest;
    }
    static isDnscontrolDsRecord(x) {
        return (x != null && typeof x === "object" && DNS_CONTROL_DS_RECORD_SYMBOL in x);
    }
    renderRecordConfig() {
        return {
            name: this.name,
            target: this.target,
            recordType: this.recordType,
            ttl: this.ttl?.toSeconds(),
            meta: this.meta,
            dsAlgorithm: dsAlgorithm[this.algorithm],
            dsDigestType: dsDigestType[this.digestType],
            dsDigest: this.digest,
            dsKeyTag: this.keytag,
        };
    }
}
exports.DnscontrolDsRecord = DnscontrolDsRecord;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJkcy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFHQSwyREFBdUQ7QUFFdkQsTUFBTSw0QkFBNEIsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDLG9CQUFvQixDQUFDLENBQUM7QUFFdEUsbUdBQW1HO0FBQ25HLE1BQU0sV0FBVyxHQUFHO0lBQ2xCLE1BQU0sRUFBRSxDQUFDO0lBQ1QsTUFBTSxFQUFFLENBQUM7SUFDVCxFQUFFLEVBQUUsQ0FBQztJQUNMLEdBQUcsRUFBRSxDQUFDO0lBQ04sT0FBTyxFQUFFLENBQUM7SUFDVixnQkFBZ0IsRUFBRSxDQUFDO0lBQ25CLG9CQUFvQixFQUFFLENBQUM7SUFDdkIsU0FBUyxFQUFFLENBQUM7SUFDWixTQUFTLEVBQUUsRUFBRTtJQUNiLFVBQVUsRUFBRSxFQUFFO0lBQ2QsZUFBZSxFQUFFLEVBQUU7SUFDbkIsZUFBZSxFQUFFLEVBQUU7SUFDbkIsT0FBTyxFQUFFLEVBQUU7SUFDWCxLQUFLLEVBQUUsRUFBRTtJQUNULE1BQU0sRUFBRSxFQUFFO0lBQ1YsWUFBWSxFQUFFLEVBQUU7SUFDaEIsUUFBUSxFQUFFLEdBQUc7SUFDYixVQUFVLEVBQUUsR0FBRztJQUNmLFVBQVUsRUFBRSxHQUFHO0NBQ1AsQ0FBQztBQUdYLFNBQVMsYUFBYSxDQUFDLENBQVU7SUFDL0IsT0FBTyxPQUFPLENBQUMsS0FBSyxRQUFRLElBQUksTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDdkUsQ0FBQztBQUNNLE1BQU0sNkJBQTZCLEdBQUcsQ0FBQyxLQUFhLEVBQWUsRUFBRTtJQUMxRSxNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLFdBQVcsRUFBRSxFQUFFO1FBQ2pFLE9BQU8sV0FBVyxDQUFDLENBQUMsQ0FBQyxLQUFLLEtBQUssQ0FB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SSxFQUFFLElBQUksQ0FBQyxJQUFJO1lBQ2YsV0FBVyxFQUFFLFdBQVcsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO1lBQ3hDLFlBQVksRUFBRSxZQUFZLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQztZQUMzQyxRQUFRLEVBQUUsSUFBSSxDQUFDLE1BQU07WUFDckIsUUFBUSxFQUFFLElBQUksQ0FBQyxNQUFNO1NBQ3RCLENBQUM7SUFDSixDQUFDO0NBQ0Y7QUFyQ0QsZ0RBcUNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSBcImNvbnN0cnVjdHNcIjtcbmltcG9ydCB7IERuc2NvbnRyb2xEc1JlY29yZENvbmZpZyB9IGZyb20gXCIuLi8uLi90eXBlcy9kbnNjb250cm9sLXJlY29yZC1jb25maWdcIjtcbmltcG9ydCB7IER1cmF0aW9uIH0gZnJvbSBcIi4uLy4uL3R5cGVzL2R1cmF0aW9uXCI7XG5pbXBvcnQgeyBEbnNjb250cm9sUmVjb3JkIH0gZnJvbSBcIi4vZG5zY29udHJvbC1yZWNvcmRcIjtcblxuY29uc3QgRE5TX0NPTlRST0xfRFNfUkVDT1JEX1NZTUJPTCA9IFN5bWJvbC5mb3IoXCJEbnNjb250cm9sRHNSZWNvcmRcIik7XG5cbi8vcmVmOiBodHRwczovL3d3dy5pYW5hLm9yZy9hc3NpZ25tZW50cy9kbnMtc2VjLWFsZy1udW1iZXJzL2Rucy1zZWMtYWxnLW51bWJlcnMueGh0bWwjcHJpbWUtbGVuZ3Roc1xuY29uc3QgZHNBbGdvcml0aG0gPSB7XG4gIERFTEVURTogMCxcbiAgUlNBTUQ1OiAxLFxuICBESDogMixcbiAgRFNBOiAzLFxuICBSU0FTSEExOiA1LFxuICBcIkRTQS1OU0VDMy1TSEExXCI6IDYsXG4gIFwiUlNBU0hBMS1OU0VDMy1TSEExXCI6IDcsXG4gIFJTQVNIQTI1NjogOCxcbiAgUlNBU0hBNTEyOiAxMCxcbiAgXCJFQ0MtR09TVFwiOiAxMixcbiAgRUNEU0FQMjU2U0hBMjU2OiAxMyxcbiAgRUNEU0FQMzg0U0hBMzg0OiAxNCxcbiAgRUQyNTUxOTogMTUsXG4gIEVENDQ4OiAxNixcbiAgU00yU00zOiAxNyxcbiAgXCJFQ0MtR09TVDEyXCI6IDIzLFxuICBJTkRJUkVDVDogMjUyLFxuICBQUklWQVRFRE5TOiAyNTMsXG4gIFBSSVZBVEVPSUQ6IDI1NCxcbn0gYXMgY29uc3Q7XG5cbmV4cG9ydCB0eXBlIERzQWxnb3JpdGhtID0ga2V5b2YgdHlwZW9mIGRzQWxnb3JpdGhtO1xuZnVuY3Rpb24gaXNEc0FsZ29yaXRobSh4OiB1bmtub3duKTogeCBpcyBEc0FsZ29yaXRobSB7XG4gIHJldHVybiB0eXBlb2YgeCA9PT0gXCJzdHJpbmdcIiAmJiBPYmplY3Qua2V5cyhkc0FsZ29yaXRobSkuaW5jbHVkZXMoeCk7XG59XG5leHBvcnQgY29uc3QgZ2V0RHNBbGdvcml0aG1TdHJpbmdGcm9tVmFsdWUgPSAodmFsdWU6IG51bWJlcik6IERzQWxnb3JpdGhtID0+IHtcbiAgY29uc3QgYWxnb3JpdGhtID0gT2JqZWN0LmVudHJpZXMoZHNBbGdvcml0aG0pLmZpbmQoKGRzQWxnb3JpdGhtKSA9PiB7XG4gICAgcmV0dXJuIGRzQWxnb3JpdGhtWzFdID09PSB2YWx1ZTtcbiAgfSk7XG4gIGNvbnN0IGRzQWxnb3JpdGhtU3RyaW5nID0gYWxnb3JpdGhtPy5bMF07XG4gIGlmIChpc0RzQWxnb3JpdGhtKGRzQWxnb3JpdGhtU3RyaW5nKSkge1xuICAgIHJldHVybiBkc0FsZ29yaXRobVN0cmluZztcbiAgfVxuICB0aHJvdyBuZXcgRXJyb3IoYEludmFsaWQgRFMgYWxnb3JpdGhtIHZhbHVlOiAke3ZhbHVlfWApO1xufTtcblxuLy9yZWY6IGh0dHBzOi8vd3d3LmlhbmEub3JnL2Fzc2lnbm1lbnRzL2RzLXJyLXR5cGVzL2RzLXJyLXR5cGVzLnhodG1sXG5jb25zdCBkc0RpZ2VzdFR5cGUgPSB7XG4gIFNIQTE6IDEsXG4gIFNIQTI1NjogMixcbiAgR09TVF9SXzM0XzExXzk0OiAzLFxuICBTSEEzODQ6IDQsXG4gIEdPU1RfUl8zNF8xMV8yMDEyOiA1LFxuICBTTTM6IDYsXG59IGFzIGNvbnN0O1xuXG5leHBvcnQgdHlwZSBEc0RpZ2VzdFR5cGUgPSBrZXlvZiB0eXBlb2YgZHNEaWdlc3RUeXBlO1xuZnVuY3Rpb24gaXNEc0RpZ2VzdFR5cGUoeDogdW5rbm93bik6IHggaXMgRHNEaWdlc3RUeXBlIHtcbiAgcmV0dXJuIHR5cGVvZiB4ID09PSBcInN0cmluZ1wiICYmIE9iamVjdC5rZXlzKGRzRGlnZXN0VHlwZSkuaW5jbHVkZXMoeCk7XG59XG5leHBvcnQgY29uc3QgZ2V0RHNEaWdlc3RUeXBlU3RyaW5nRnJvbVZhbHVlID0gKHZhbHVlOiBudW1iZXIpOiBEc0RpZ2VzdFR5cGUgPT4ge1xuICBjb25zdCBkaWdlc3RUeXBlID0gT2JqZWN0LmVudHJpZXMoZHNEaWdlc3RUeXBlKS5maW5kKChkc0RpZ2VzdFR5cGUpID0+IHtcbiAgICByZXR1cm4gZHNEaWdlc3RUeXBlWzFdID09PSB2YWx1ZTtcbiAgfSk7XG4gIGNvbnN0IGRzRGlnZXN0VHlwZVN0cmluZyA9IGRpZ2VzdFR5cGU/LlswXTtcbiAgaWYgKGlzRHNEaWdlc3RUeXBlKGRzRGlnZXN0VHlwZVN0cmluZykpIHtcbiAgICByZXR1cm4gZHNEaWdlc3RUeXBlU3RyaW5nO1xuICB9XG4gIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBEUyBkaWdlc3QgdHlwZSB2YWx1ZTogJHt2YWx1ZX1gKTtcbn07XG5cbmV4cG9ydCBpbnRlcmZhY2UgRG5zY29udHJvbERzUmVjb3JkUHJvcHMge1xuICByZWFkb25seSBsYWJlbDogc3RyaW5nO1xuICByZWFkb25seSBrZXl0YWc6IG51bWJlcjtcbiAgcmVhZG9ubHkgYWxnb3JpdGhtOiBEc0FsZ29yaXRobTtcbiAgcmVhZG9ubHkgZGlnZXN0VHlwZTogRHNEaWdlc3RUeXBlO1xuICByZWFkb25seSBkaWdlc3Q6IHN0cmluZztcbiAgcmVhZG9ubHkgdHRsPzogRHVyYXRpb24gfCB1bmRlZmluZWQ7XG4gIHJlYWRvbmx5IGlzRW5zdXJlZEFic2VudD86IGJvb2xlYW4gfCB1bmRlZmluZWQ7XG4gIHJlYWRvbmx5IG1ldGE/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+IHwgdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgY2xhc3MgRG5zY29udHJvbERzUmVjb3JkIGV4dGVuZHMgRG5zY29udHJvbFJlY29yZCB7XG4gIHB1YmxpYyByZWFkb25seSBrZXl0YWc6IG51bWJlcjtcbiAgcHVibGljIHJlYWRvbmx5IGFsZ29yaXRobTogRHNBbGdvcml0aG07XG4gIHB1YmxpYyByZWFkb25seSBkaWdlc3RUeXBlOiBEc0RpZ2VzdFR5cGU7XG4gIHB1YmxpYyByZWFkb25seSBkaWdlc3Q6IHN0cmluZztcbiAgY29uc3RydWN0b3Ioc2NvcGU6IENvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IERuc2NvbnRyb2xEc1JlY29yZFByb3BzKSB7XG4gICAgc3VwZXIoc2NvcGUsIGlkLCB7XG4gICAgICByZWNvcmRUeXBlOiBcIkRTXCIsXG4gICAgICBsYWJlbDogcHJvcHMubGFiZWwsXG4gICAgICB0YXJnZXQ6IFwiXCIsXG4gICAgICB0dGw6IHByb3BzLnR0bCxcbiAgICAgIGlzRW5zdXJlZEFic2VudDogcHJvcHMuaXNFbnN1cmVkQWJzZW50LFxuICAgICAgbWV0YTogcHJvcHMubWV0YSxcbiAgICB9KTtcbiAgICB0aGlzLmtleXRhZyA9IHByb3BzLmtleXRhZztcbiAgICB0aGlzLmFsZ29yaXRobSA9IHByb3BzLmFsZ29yaXRobTtcbiAgICB0aGlzLmRpZ2VzdFR5cGUgPSBwcm9wcy5kaWdlc3RUeXBlO1xuICAgIHRoaXMuZGlnZXN0ID0gcHJvcHMuZGlnZXN0O1xuICB9XG4gIHB1YmxpYyBzdGF0aWMgaXNEbnNjb250cm9sRHNSZWNvcmQoeDogdW5rbm93bik6IHggaXMgRG5zY29udHJvbERzUmVjb3JkIHtcbiAgICByZXR1cm4gKFxuICAgICAgeCAhPSBudWxsICYmIHR5cGVvZiB4ID09PSBcIm9iamVjdFwiICYmIEROU19DT05UUk9MX0RTX1JFQ09SRF9TWU1CT0wgaW4geFxuICAgICk7XG4gIH1cbiAgcHVibGljIHJlbmRlclJlY29yZENvbmZpZygpOiBEbnNjb250cm9sRHNSZWNvcmRDb25maWcge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiB0aGlzLm5hbWUsXG4gICAgICB0YXJnZXQ6IHRoaXMudGFyZ2V0LFxuICAgICAgcmVjb3JkVHlwZTogdGhpcy5yZWNvcmRUeXBlLFxuICAgICAgdHRsOiB0aGlzLnR0bD8udG9TZWNvbmRzKCksXG4gICAgICBtZXRhOiB0aGlzLm1ldGEsXG4gICAgICBkc0FsZ29yaXRobTogZHNBbGdvcml0aG1bdGhpcy5hbGdvcml0aG1dLFxuICAgICAgZHNEaWdlc3RUeXBlOiBkc0RpZ2VzdFR5cGVbdGhpcy5kaWdlc3RUeXBlXSxcbiAgICAgIGRzRGlnZXN0OiB0aGlzLmRpZ2VzdCxcbiAgICAgIGRzS2V5VGFnOiB0aGlzLmtleXRhZyxcbiAgICB9O1xuICB9XG59XG4iXX0=